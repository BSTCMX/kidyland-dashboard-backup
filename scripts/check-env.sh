#!/bin/bash

# check-env.sh - Verificaciรณn de compatibilidad del entorno
# Este script valida que las versiones del sistema sean compatibles con el proyecto

set -e

# Colores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Contador de errores
ERRORS=0
WARNINGS=0

echo "๐ Verificando compatibilidad del entorno para Kidyland Monorepo..."
echo ""

# Funciรณn para comparar versiones
version_compare() {
    local version1=$1
    local version2=$2
    local operator=$3
    
    # Remover 'v' y otros prefijos
    version1=$(echo "$version1" | sed 's/^v//')
    version2=$(echo "$version2" | sed 's/^v//')
    
    # Comparar versiones usando sort -V
    if [ "$operator" = ">=" ]; then
        if printf '%s\n%s\n' "$version2" "$version1" | sort -V -C; then
            return 0  # version1 >= version2
        else
            return 1
        fi
    elif [ "$operator" = ">" ]; then
        if printf '%s\n%s\n' "$version1" "$version2" | sort -V -C && [ "$version1" != "$version2" ]; then
            return 0  # version1 > version2
        else
            return 1
        fi
    fi
}

# Verificar Node.js
echo "๐ฆ Node.js:"
NODE_VERSION=$(node -v 2>/dev/null || echo "NOT_FOUND")
if [ "$NODE_VERSION" = "NOT_FOUND" ]; then
    echo -e "  ${RED}โ Node.js no encontrado${NC}"
    ERRORS=$((ERRORS + 1))
else
    echo "  Versiรณn detectada: $NODE_VERSION"
    if version_compare "$NODE_VERSION" "18.20.0" ">="; then
        echo -e "  ${GREEN}โ Compatible (>= 18.20.0)${NC}"
    else
        echo -e "  ${RED}โ Requiere Node.js >= 18.20.0${NC}"
        ERRORS=$((ERRORS + 1))
    fi
fi
echo ""

# Verificar pnpm
echo "๐ฆ pnpm:"
PNPM_VERSION=$(pnpm -v 2>/dev/null || echo "NOT_FOUND")
if [ "$PNPM_VERSION" = "NOT_FOUND" ]; then
    echo -e "  ${RED}โ pnpm no encontrado${NC}"
    ERRORS=$((ERRORS + 1))
else
    echo "  Versiรณn detectada: $PNPM_VERSION"
    if version_compare "$PNPM_VERSION" "8.15.0" ">="; then
        echo -e "  ${GREEN}โ Compatible (>= 8.15.0)${NC}"
    else
        echo -e "  ${RED}โ Requiere pnpm >= 8.15.0${NC}"
        ERRORS=$((ERRORS + 1))
    fi
fi
echo ""

# Verificar Python
echo "๐ Python:"
PYTHON_VERSION=$(python3 --version 2>/dev/null | awk '{print $2}' || echo "NOT_FOUND")
if [ "$PYTHON_VERSION" = "NOT_FOUND" ]; then
    echo -e "  ${RED}โ Python 3 no encontrado${NC}"
    ERRORS=$((ERRORS + 1))
else
    echo "  Versiรณn detectada: $PYTHON_VERSION"
    if version_compare "$PYTHON_VERSION" "3.11.0" ">="; then
        echo -e "  ${GREEN}โ Compatible (>= 3.11.0)${NC}"
    else
        echo -e "  ${RED}โ Requiere Python >= 3.11.0${NC}"
        ERRORS=$((ERRORS + 1))
    fi
fi
echo ""

# Verificar pip
echo "๐ฆ pip:"
PIP_VERSION=$(pip3 --version 2>/dev/null | awk '{print $2}' || echo "NOT_FOUND")
if [ "$PIP_VERSION" = "NOT_FOUND" ]; then
    echo -e "  ${YELLOW}โ pip no encontrado (puede estar en venv)${NC}"
    WARNINGS=$((WARNINGS + 1))
else
    echo "  Versiรณn detectada: $PIP_VERSION"
    echo -e "  ${GREEN}โ pip disponible${NC}"
fi
echo ""

# Verificar arquitectura
echo "๐ป Arquitectura:"
ARCH=$(uname -m)
echo "  Arquitectura: $ARCH"
if [ "$ARCH" = "x86_64" ] || [ "$ARCH" = "arm64" ]; then
    echo -e "  ${GREEN}โ Compatible${NC}"
else
    echo -e "  ${YELLOW}โ Arquitectura no comรบn, puede haber problemas${NC}"
    WARNINGS=$((WARNINGS + 1))
fi
echo ""

# Verificar sistema operativo
echo "๐ฅ๏ธ  Sistema Operativo:"
OS=$(uname -s)
echo "  OS: $OS"
if [ "$OS" = "Darwin" ]; then
    if command -v sw_vers &> /dev/null; then
        MACOS_VERSION=$(sw_vers -productVersion)
        echo "  macOS: $MACOS_VERSION"
    fi
    echo -e "  ${GREEN}โ macOS compatible${NC}"
elif [ "$OS" = "Linux" ]; then
    echo -e "  ${GREEN}โ Linux compatible${NC}"
else
    echo -e "  ${YELLOW}โ OS no probado, puede haber problemas${NC}"
    WARNINGS=$((WARNINGS + 1))
fi
echo ""

# Verificar herramientas Python (si venv estรก activo)
if [ -n "$VIRTUAL_ENV" ]; then
    echo "๐ Entorno Virtual Python:"
    echo "  ${GREEN}โ Venv activo: $VIRTUAL_ENV${NC}"
    
    # Verificar ruff
    if command -v ruff &> /dev/null; then
        RUFF_VERSION=$(ruff --version 2>/dev/null | awk '{print $2}' || echo "unknown")
        echo "  ruff: $RUFF_VERSION"
        if version_compare "$RUFF_VERSION" "0.6.0" ">="; then
            echo -e "    ${GREEN}โ Compatible${NC}"
        else
            echo -e "    ${YELLOW}โ Versiรณn antigua, se recomienda >= 0.6.0${NC}"
            WARNINGS=$((WARNINGS + 1))
        fi
    else
        echo -e "  ${YELLOW}โ ruff no encontrado (instalar con: pip install -r requirements-dev.txt)${NC}"
        WARNINGS=$((WARNINGS + 1))
    fi
    
    # Verificar black
    if command -v black &> /dev/null; then
        BLACK_VERSION=$(black --version 2>/dev/null | awk '{print $3}' || echo "unknown")
        echo "  black: $BLACK_VERSION"
        if version_compare "$BLACK_VERSION" "24.0.0" ">="; then
            echo -e "    ${GREEN}โ Compatible${NC}"
        else
            echo -e "    ${YELLOW}โ Versiรณn antigua, se recomienda >= 24.0.0${NC}"
            WARNINGS=$((WARNINGS + 1))
        fi
    else
        echo -e "  ${YELLOW}โ black no encontrado (instalar con: pip install -r requirements-dev.txt)${NC}"
        WARNINGS=$((WARNINGS + 1))
    fi
    
    # Verificar mypy
    if command -v mypy &> /dev/null; then
        MYPY_VERSION=$(mypy --version 2>/dev/null | awk '{print $2}' || echo "unknown")
        echo "  mypy: $MYPY_VERSION"
        if version_compare "$MYPY_VERSION" "1.11.0" ">="; then
            echo -e "    ${GREEN}โ Compatible${NC}"
        else
            echo -e "    ${YELLOW}โ Versiรณn antigua, se recomienda >= 1.11.0${NC}"
            WARNINGS=$((WARNINGS + 1))
        fi
    else
        echo -e "  ${YELLOW}โ mypy no encontrado (instalar con: pip install -r requirements-dev.txt)${NC}"
        WARNINGS=$((WARNINGS + 1))
    fi
    echo ""
fi

# Resumen
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโshared/package.json































